{{ define "customScripts" }}
<script>
  const code = "{{ .code }}"
  const privacyModal = document.getElementById('privacyModal');
  const startButton = privacyModal.querySelector('.button.is-primary.start');
  // Add event listener to the "Start" button
  startButton.addEventListener('click', function () {
    privacyModal.classList.add("hidden")
    const videos = document.getElementById('videos');
    const controls = document.getElementsByClassName('controls')[0]

    videos.classList.remove("hidden")
    controls.classList.remove("hidden")
    startVideo()
  });
  function startVideo() {
    // Get the local video element
    const secondaryVideo = document.getElementById('secondaryVideo');
    // Start the video stream
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        // Display the local video stream
        secondaryVideo.srcObject = stream;
        const configuration = { 'iceServers': [{ 'urls': 'stun:stun.l.google.com:19302' }] };
        const pc = new RTCPeerConnection(configuration);
        // Add the local stream to the connection
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
        // Create an offer and set local description
        pc.createOffer()
          .then(offer => pc.setLocalDescription(offer))
          .then(async () => {
            console.log('Local SDP offer:', pc.localDescription);
            startwebsocket(pc.localDescription);
          })
          .catch(error => console.error('Error creating offer:', error));
      })
      .catch(error => console.error('Error accessing media devices:', error));
  }

  function copyToClipboard() {
    var copyText = document.getElementById("copyCode");
    copyText.select();
    document.execCommand("copy");
  }
</script>
{{end}}